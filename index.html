<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MeteMatik</title>

<style>
body{
  font-family: Arial, sans-serif;
  margin:0;
  padding:20px;
  background:linear-gradient(135deg,#e3f2fd,#e0f7fa);
  color:#004d40;
  display:flex;
  flex-direction:column;
  align-items:center;
}

h1{
  font-size:3.2rem;
  margin-bottom:10px;
  color:#00695c;
}

.card{
  background:white;
  border-radius:16px;
  padding:20px;
  box-shadow:0 8px 25px rgba(0,0,0,0.1);
  width:100%;
  max-width:900px;
  margin-bottom:20px;
}

#carb-result{
  font-size:2.2rem;
  font-weight:bold;
  text-align:center;
}

#carb-calculator{
  display:flex;
  gap:25px;
  justify-content:center;
  flex-wrap:wrap;
}

.food-group{
  min-width:220px;
}

.food-group-label{
  font-size:1.3rem;
  font-weight:bold;
  margin-bottom:8px;
  text-align:center;
}

select,input{
  padding:8px;
  border-radius:8px;
  border:1px solid #ccc;
  width:100%;
  margin-top:5px;
  font-size:1rem;
}

button{
  padding:10px 16px;
  border:none;
  border-radius:8px;
  cursor:pointer;
}

#adminBtn{
  position:fixed;
  bottom:20px;
  right:20px;
  background:#00796b;
  color:white;
}

.modal{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.55);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:999;
}

.modal-content{
  background:white;
  padding:25px;
  border-radius:14px;
  width:360px;
  max-height:90vh;
  overflow-y:auto;
}

.section{
  margin-bottom:25px;
  padding-bottom:15px;
  border-bottom:1px solid #eee;
}

.section h3{
  margin-top:0;
}

label{
  font-size:0.9rem;
  margin-top:8px;
  display:block;
}

.admin-buttons{
  display:flex;
  gap:10px;
  margin-top:15px;
}

.delete-row{
  display:flex;
  gap:10px;
  align-items:center;
}

@media(max-width:700px){
  #carb-calculator{flex-direction:column}
}
</style>
</head>

<body>

<h1>MeteMatik</h1>

<div class="card">
  <div id="carb-result">Karbonhidrat: 0</div>
</div>

<div class="card" id="carb-calculator">

<div class="food-group">
<div class="food-group-label">üçï Pizza</div>
<select id="pizza-select"></select>
<input id="pizza-amount" type="number" min="0" placeholder="Miktar">
</div>

<div class="food-group">
<div class="food-group-label">üç≠ ≈ûeker</div>
<select id="sugar-select"></select>
<input id="sugar-amount" type="number" min="0" placeholder="Miktar">
</div>

<div class="food-group">
<div class="food-group-label">üåÆ Taco</div>
<select id="taco-select"></select>
<input id="taco-amount" type="number" min="0" placeholder="Miktar">
</div>

</div>

<button id="adminBtn">‚öô Yiyecek Y√∂net</button>

<div class="modal" id="adminModal">
  <div class="modal-content">

    <div class="section">
      <h3>‚ûï Yeni Yiyecek Ekle</h3>

      <label>Yiyecek adƒ±</label>
      <input id="newName">

      <label>Grup</label>
      <select id="newGroup">
        <option value="pizza">Pizza</option>
        <option value="sugar">≈ûeker</option>
        <option value="taco">Taco</option>
      </select>

      <label>Hesaplama t√ºr√º</label>
      <select id="newType">
        <option value="gram">100 gr √ºzerinden</option>
        <option value="adet">Adet √ºzerinden</option>
      </select>

      <label id="valueLabel">Karbonhidrat</label>
      <input id="newCarb" type="number" min="0">

      <button onclick="confirmAddFood()">Yiyeceƒüi Ekle</button>
    </div>


    <div class="section">
      <h3>üóë Yiyecek Sil</h3>

      <label>Grup</label>
      <select id="deleteGroup" onchange="populateDeleteList()">
        <option value="pizza">Pizza</option>
        <option value="sugar">≈ûeker</option>
        <option value="taco">Taco</option>
      </select>

      <label>Yiyecek</label>
      <select id="deleteFood"></select>

      <button onclick="confirmDeleteFood()">Sil</button>
    </div>


    <button onclick="closeAdmin()">Kapat</button>
  </div>
</div>

<script>

const ADMIN_PASSWORD="omurmete";

const defaultFoods={
pizza:[
 {name:"Pide",type:"gram",carbPerGram:0.4},
 {name:"Pi≈üi",type:"gram",carbPerGram:0.4}
],
sugar:[
 {name:"Baklava Cevizli Dilim",type:"adet",carbPerUnit:15},
 {name:"Baklava Fƒ±stƒ±klƒ± Dilim",type:"adet",carbPerUnit:20},
 {name:"Dondurma Top",type:"adet",carbPerUnit:25},
 {name:"Karpuz",type:"gram",carbPerGram:0.08},
 {name:"Kavun",type:"gram",carbPerGram:0.08},
 {name:"Kek",type:"gram",carbPerGram:0.45},
 {name:"Kƒ±brƒ±s Tatlƒ±sƒ±",type:"gram",carbPerGram:0.29},
 {name:"Krep Adet",type:"adet",carbPerUnit:15},
 {name:"Mandalina Adet",type:"adet",carbPerUnit:10},
 {name:"Muz ƒ∞thal Adet",type:"adet",carbPerUnit:15},
 {name:"Muz Yerli Adet",type:"adet",carbPerUnit:10},
 {name:"Pasta Pastaban",type:"gram",carbPerGram:0.5},
 {name:"Puding (1 kase)",type:"adet",carbPerUnit:15},
 {name:"Waffle Pastanecim Adet",type:"adet",carbPerUnit:50},
 {name:"Ya≈ü Pasta Migros",type:"gram",carbPerGram:0.45}
],
taco:[
 {name:"Bazlama",type:"gram",carbPerGram:0.5},
 {name:"B√∂rek",type:"gram",carbPerGram:0.2},
 {name:"Ekmek",type:"gram",carbPerGram:0.6},
 {name:"Ka≈üar Dilim",type:"adet",carbPerUnit:2.5},
 {name:"Mantƒ±",type:"gram",carbPerGram:0.35},
 {name:"Makarna",type:"gram",carbPerGram:0.25},
 {name:"Patates Kzrtm",type:"gram",carbPerGram:0.3},
 {name:"Patates Kzrtm Hazƒ±r",type:"gram",carbPerGram:0.2},
 {name:"Patatesli Yumurta",type:"gram",carbPerGram:0.2},
 {name:"Pilav",type:"gram",carbPerGram:0.28},
 {name:"Salam Dilim",type:"adet",carbPerUnit:2.5},
 {name:"Simit",type:"gram",carbPerGram:0.45},
 {name:"Tavuk Lava≈ü D√ºr√ºm",type:"adet",carbPerUnit:70}
]
};

let foods=JSON.parse(localStorage.getItem("foods"))||defaultFoods;

function saveFoods(){
 localStorage.setItem("foods",JSON.stringify(foods));
 renderAll();
}

function sortFoods(arr){
 return arr.sort((a,b)=>a.name.localeCompare(b.name,'tr'));
}

function populateSelect(id,list){
 const sel=document.getElementById(id);
 sel.innerHTML="<option value=''>Se√ß</option>";
 sortFoods(list).forEach((f,i)=>{
   const o=document.createElement("option");
   o.value=i;
   o.textContent=f.name;
   sel.appendChild(o);
 });
}

function renderAll(){
 populateSelect("pizza-select",foods.pizza);
 populateSelect("sugar-select",foods.sugar);
 populateSelect("taco-select",foods.taco);
 populateDeleteList();
}

renderAll();

function calcGroup(group,selectId,inputId){
 const index=document.getElementById(selectId).value;
 const amount=parseFloat(document.getElementById(inputId).value);
 if(index===""||!amount)return 0;
 const food=foods[group][index];
 if(food.type==="gram")return amount*food.carbPerGram;
 if(food.type==="adet")return amount*food.carbPerUnit;
 return 0;
}

function calculate(){
 let total=0;
 total+=calcGroup("pizza","pizza-select","pizza-amount");
 total+=calcGroup("sugar","sugar-select","sugar-amount");
 total+=calcGroup("taco","taco-select","taco-amount");
 document.getElementById("carb-result").textContent="Karbonhidrat: "+Math.round(total);
}

["pizza-select","pizza-amount","sugar-select","sugar-amount","taco-select","taco-amount"].forEach(id=>{
 document.getElementById(id).addEventListener("input",calculate);
});



// ADMIN

document.getElementById("adminBtn").onclick=()=>{
 document.getElementById("adminModal").style.display="flex";
};

function closeAdmin(){
 document.getElementById("adminModal").style.display="none";
}


// ADD FOOD
function confirmAddFood(){
 const name=document.getElementById("newName").value.trim();
 const group=document.getElementById("newGroup").value;
 const type=document.getElementById("newType").value;
 const carb=parseFloat(document.getElementById("newCarb").value);

 if(!name||isNaN(carb)){
   alert("Bilgileri doldurun");
   return;
 }

 const pass=prompt("Eklemek i√ßin ≈üifre girin");
 if(pass!==ADMIN_PASSWORD){
   alert("≈ûifre yanlƒ±≈ü");
   return;
 }

 const food={name,type};
 if(type==="gram")food.carbPerGram=carb/100;
 if(type==="adet")food.carbPerUnit=carb;

 foods[group].push(food);
 saveFoods();
 alert("Eklendi");
}


// DELETE FOOD
function populateDeleteList(){
 const group=document.getElementById("deleteGroup").value;
 const sel=document.getElementById("deleteFood");
 sel.innerHTML="";
 sortFoods(foods[group]).forEach((f,i)=>{
   const o=document.createElement("option");
   o.value=i;
   o.textContent=f.name;
   sel.appendChild(o);
 });
}

function confirmDeleteFood(){
 const group=document.getElementById("deleteGroup").value;
 const index=document.getElementById("deleteFood").value;
 if(index==="")return;

 const pass=prompt("Silmek i√ßin ≈üifre girin");
 if(pass!==ADMIN_PASSWORD){
   alert("≈ûifre yanlƒ±≈ü");
   return;
 }

 foods[group].splice(index,1);
 saveFoods();
 alert("Silindi");
}


// OFFLINE
if("serviceWorker" in navigator){
 const swCode=`
  self.addEventListener('install',e=>{
    e.waitUntil(caches.open('metematik-v2').then(c=>c.addAll(['./'])));
  });
  self.addEventListener('fetch',e=>{
    e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request)));
  });`;
 const blob=new Blob([swCode],{type:'text/javascript'});
 const swURL=URL.createObjectURL(blob);
 navigator.serviceWorker.register(swURL);
}

</script>
</body>
</html>
