<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MeteMatik</title>

<style>
body{
  font-family: Arial, sans-serif;
  margin:0;
  padding:20px;
  background:linear-gradient(135deg,#e3f2fd,#e0f7fa);
  color:#004d40;
  display:flex;
  flex-direction:column;
  align-items:center;
}

h1{
  font-size:3.2rem;
  margin-bottom:10px;
  color:#00695c;
}

.card{
  background:white;
  border-radius:16px;
  padding:20px;
  box-shadow:0 8px 25px rgba(0,0,0,0.1);
  width:100%;
  max-width:900px;
  margin-bottom:20px;
}

#carb-result{
  font-size:2.2rem;
  font-weight:bold;
  text-align:center;
}

#carb-calculator{
  display:flex;
  gap:25px;
  justify-content:center;
  flex-wrap:wrap;
}

.food-group{
  min-width:220px;
}

.food-group-label{
  font-size:1.3rem;
  font-weight:bold;
  margin-bottom:8px;
  text-align:center;
}

select,input{
  padding:6px;
  border-radius:6px;
  border:1px solid #ccc;
  width:100%;
  margin-top:5px;
}

button{
  padding:10px 16px;
  border:none;
  border-radius:8px;
  cursor:pointer;
}

#adminBtn{
  position:fixed;
  bottom:20px;
  right:20px;
  background:#00796b;
  color:white;
}

.modal{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.5);
  display:none;
  justify-content:center;
  align-items:center;
}

.modal-content{
  background:white;
  padding:20px;
  border-radius:12px;
  width:320px;
}

.food-row{
  display:flex;
  justify-content:space-between;
  margin-bottom:6px;
}

@media(max-width:700px){
  #carb-calculator{flex-direction:column}
}
</style>
</head>

<body>

<h1>MeteMatik</h1>

<div class="card">
  <div id="carb-result">Karbonhidrat: 0</div>
</div>

<div class="card" id="carb-calculator">

<div class="food-group">
<div class="food-group-label">üçï Pizza</div>
<select id="pizza-select"></select>
<input id="pizza-amount" type="number" min="0" placeholder="Miktar">
</div>

<div class="food-group">
<div class="food-group-label">üç≠ ≈ûeker</div>
<select id="sugar-select"></select>
<input id="sugar-amount" type="number" min="0" placeholder="Miktar">
</div>

<div class="food-group">
<div class="food-group-label">üåÆ Taco</div>
<select id="taco-select"></select>
<input id="taco-amount" type="number" min="0" placeholder="Miktar">
</div>

</div>

<button id="adminBtn">‚öô Yiyecek Y√∂net</button>

<div class="modal" id="adminModal">
  <div class="modal-content">
    <h3>Yiyecek Y√∂netimi</h3>

    <button onclick="addFoodPrompt()">Yiyecek Ekle</button>
    <hr>
    <div id="foodList"></div>
    <hr>
    <button onclick="closeAdmin()">Kapat</button>
  </div>
</div>

<script>

const ADMIN_PASSWORD="omurmete";

const defaultFoods={

pizza:[
 {name:"Pide",type:"gram",carbPerGram:0.4},
 {name:"Pi≈üi",type:"gram",carbPerGram:0.4}
],

sugar:[
 {name:"Baklava Cevizli Dilim",type:"adet",carbPerUnit:15},
 {name:"Baklava Fƒ±stƒ±klƒ± Dilim",type:"adet",carbPerUnit:20},
 {name:"Dondurma Top",type:"adet",carbPerUnit:25},
 {name:"Karpuz",type:"gram",carbPerGram:0.08},
 {name:"Kavun",type:"gram",carbPerGram:0.08},
 {name:"Kek",type:"gram",carbPerGram:0.45},
 {name:"Kƒ±brƒ±s Tatlƒ±sƒ±",type:"gram",carbPerGram:0.29},
 {name:"Krep Adet",type:"adet",carbPerUnit:15},
 {name:"Mandalina Adet",type:"adet",carbPerUnit:10},
 {name:"Muz ƒ∞thal Adet",type:"adet",carbPerUnit:15},
 {name:"Muz Yerli Adet",type:"adet",carbPerUnit:10},
 {name:"Pasta Pastaban",type:"gram",carbPerGram:0.5},
 {name:"Puding (1 kase)",type:"adet",carbPerUnit:15},
 {name:"Waffle Pastanecim Adet",type:"adet",carbPerUnit:50},
 {name:"Ya≈ü Pasta Migros",type:"gram",carbPerGram:0.45}
],

taco:[
 {name:"Bazlama",type:"gram",carbPerGram:0.5},
 {name:"B√∂rek",type:"gram",carbPerGram:0.2},
 {name:"Ekmek",type:"gram",carbPerGram:0.6},
 {name:"Ka≈üar Dilim",type:"adet",carbPerUnit:2.5},
 {name:"Mantƒ±",type:"gram",carbPerGram:0.35},
 {name:"Makarna",type:"gram",carbPerGram:0.25},
 {name:"Patates Kzrtm",type:"gram",carbPerGram:0.3},
 {name:"Patates Kzrtm Hazƒ±r",type:"gram",carbPerGram:0.2},
 {name:"Patatesli Yumurta",type:"gram",carbPerGram:0.2},
 {name:"Pilav",type:"gram",carbPerGram:0.28},
 {name:"Salam Dilim",type:"adet",carbPerUnit:2.5},
 {name:"Simit",type:"gram",carbPerGram:0.45},
 {name:"Tavuk Lava≈ü D√ºr√ºm",type:"adet",carbPerUnit:70}
]
};

let foods=JSON.parse(localStorage.getItem("foods"))||defaultFoods;

function saveFoods(){
 localStorage.setItem("foods",JSON.stringify(foods));
 renderAll();
}

function sortFoods(arr){
 return arr.sort((a,b)=>a.name.localeCompare(b.name,'tr'));
}

function populateSelect(id,list){
 const sel=document.getElementById(id);
 sel.innerHTML="<option value=''>Se√ß</option>";
 sortFoods(list).forEach((f,i)=>{
   const o=document.createElement("option");
   o.value=i;
   o.textContent=f.name;
   sel.appendChild(o);
 });
}

function renderAll(){
 populateSelect("pizza-select",foods.pizza);
 populateSelect("sugar-select",foods.sugar);
 populateSelect("taco-select",foods.taco);
 renderFoodList();
}

renderAll();

function calcGroup(group,selectId,inputId){
 const index=document.getElementById(selectId).value;
 const amount=parseFloat(document.getElementById(inputId).value);
 if(index===""||!amount)return 0;
 const food=foods[group][index];
 if(food.type==="gram")return amount*food.carbPerGram;
 if(food.type==="adet")return amount*food.carbPerUnit;
 return 0;
}

function calculate(){
 let total=0;
 total+=calcGroup("pizza","pizza-select","pizza-amount");
 total+=calcGroup("sugar","sugar-select","sugar-amount");
 total+=calcGroup("taco","taco-select","taco-amount");
 document.getElementById("carb-result").textContent="Karbonhidrat: "+Math.round(total);
}

["pizza-select","pizza-amount","sugar-select","sugar-amount","taco-select","taco-amount"].forEach(id=>{
 document.getElementById(id).addEventListener("input",calculate);
});



// ADMIN

document.getElementById("adminBtn").onclick=()=>{
 const p=prompt("≈ûifre");
 if(p!==ADMIN_PASSWORD)return;
 document.getElementById("adminModal").style.display="flex";
};

function closeAdmin(){
 document.getElementById("adminModal").style.display="none";
}

function addFoodPrompt(){
 const name=prompt("Yiyecek adƒ±");
 if(!name)return;

 const group=prompt("Grup: pizza / sugar / taco");
 if(!foods[group])return alert("Grup hatalƒ±");

 const type=prompt("T√ºr: gram / adet");
 if(type!=="gram"&&type!=="adet")return;

 const carb=parseFloat(prompt(type==="gram"?"100 gramdaki karbonhidrat":"1 adette karbonhidrat"));
 if(isNaN(carb))return;

 const food={name,type};
 if(type==="gram")food.carbPerGram=carb/100;
 if(type==="adet")food.carbPerUnit=carb;

 foods[group].push(food);
 saveFoods();
}

function renderFoodList(){
 const box=document.getElementById("foodList");
 box.innerHTML="";

 Object.keys(foods).forEach(group=>{
   const title=document.createElement("div");
   title.innerHTML="<b>"+group.toUpperCase()+"</b>";
   box.appendChild(title);

   sortFoods(foods[group]).forEach((f,i)=>{
     const row=document.createElement("div");
     row.className="food-row";
     row.innerHTML=`${f.name} <button onclick="removeFood('${group}','${f.name}')">X</button>`;
     box.appendChild(row);
   });
 });
}

function removeFood(group,name){
 foods[group]=foods[group].filter(f=>f.name!==name);
 saveFoods();
}



// OFFLINE SERVICE WORKER
if("serviceWorker" in navigator){
 const swCode=`
  self.addEventListener('install',e=>{
    e.waitUntil(caches.open('metematik-v1').then(c=>c.addAll(['./'])));
  });
  self.addEventListener('fetch',e=>{
    e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request)));
  });`;

 const blob=new Blob([swCode],{type:'text/javascript'});
 const swURL=URL.createObjectURL(blob);
 navigator.serviceWorker.register(swURL);
}

</script>
</body>
</html>
